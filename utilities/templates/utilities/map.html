{% extends 'utilities/home.html' %}
{% load static %}

{% block title %} Web Map {% endblock %}

{% block currentpage %}
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
                <a class="nav-link" href="{% url 'homepage' %}">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" aria-current="page"  href="{% url 'webmap' %}">Map</a>
            </li>
        </ul>
    </div>
    <div class="collapse navbar-collapse justify-content-end">
        <ul class="navbar-nav">
                {% csrf_token %}
                {% if user.is_authenticated %}
                    <li class="nav-item">
                        <a class="nav-link text-success">{{user.username}} </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-danger " href="{% url 'signOut' %}">Log Out</a>
                    </li>
                {% else %}
                    <li class="nav-item text-end">
                        <a class="nav-link text-danger" href="{% url 'signIn' %}">Log In</a>
                    </li>
                {% endif %}
        </ul>
    </div>
{% endblock %}
{% block content %}
    <div id="map"></div>
    {% comment %} <div id="zoom" class="zoom"></div> {% endcomment %}
    <div id="scale-line" class="scale-line"></div>
    <div id="overviewmap" class="overviewmap"></div>
    <div id="display-coordinate" class="display-coordinate"></div>
    <a href="javascript:void(0);" class="icon" onclick="showSideBar()">
        <i class="fa fa-bars"></i>
    </a>
    <div id="printForm" class="sidebar-config-wrap overflow-hidden" role="form">
        <div class="panel-group h-100" id="accordion" role="tablist" aria-multiselectable="true">
            <div class="panel panel-primary toolBar w-100" id="toolBar">
                <div class="panel-body content container" style="display: flex;justify-content: space-evenly;">
                    <button type="button" class="btn btn-secondary" id="measureDistance" data-toggle="tooltip"
                        data-placement="top" title="Measure Distance" onclick="measure('line')">
                        <i class="fas fa-pen fa-lg"></i>
                    </button>
                    <button type="button" class="btn btn-secondary" id="measureArea" data-toggle="tooltip"
                        data-placement="top" title="Measure Area" onclick="measure('area')">
                        <i class="far fa-clone fa-lg"></i>
                    </button>
                    <button type="button" class="btn btn-secondary" id="clearDraw" data-toggle="tooltip"
                        data-placement="top" title="Reset" onclick="clearDraw()">
                        <i class="fas fa-eraser fa-lg"></i>
                    </button>
                    <button type="button" class="btn btn-secondary" id="defaultExtent" data-toggle="tooltip"
                        data-placement="top" title="Default Extent" onclick="defaultExtent()">
                        <i class="fas fa-home fa-lg"></i>
                    </button>
                    <button type="button" class="btn btn-secondary" id="search" data-toggle="tooltip" data-placement="top"
                        title="Search Complaints" onclick="showInput()">
                        <i class="fas fa-search fa-lg"></i>
                    </button>
                    <button type="button" class="btn btn-secondary" id="help" data-toggle="tooltip" data-placement="top"
                        title="User Role" onclick="alert('{{user.username}}')">
                        <i class="fas fa-user fa-lg"></i>
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#helpmodal" title="Help">
                        <i class="fas fa-info-circle fa-lg"></i>
                    </button>
                    <button type="button" class="btn btn-primary" id="close" data-toggle="tooltip" data-placement="top" title="Close" onclick="hideSideBar()">
                        <i class="fas fa-times fa-lg"></i>
                    </button>
                </div>
            </div>
            <br>
            <hr style="color:#FFF; margin-left: -1rem; margin-right: -1rem;">
            <div class="row h-100 gx-0" id="second-container" >
                <div class="col col-lg-3">
                    <nav class="nav flex-column navbar-dark h-100" id="second-nav-bar">
                        <a class="nav-link row" id="layers-nav-link" href="#" onclick="displayToggler()">
                            <div class="col-12 text-center">
                                <i class="fas fa-layer-group fa-2x"></i>
                            </div>
                            <div class="col-12 text-center" style="font-size:0.8rem;">Layers</div>
                        </a>
                        <hr class="left-menu-item-line">
                        <a class="nav-link row" id="query-nav-link" href="#" onclick="displayQueryFeature()">
                            <div class="col-12 text-center">
                                <i class="fas fa-search-location fa-2x"></i>
                            </div>
                            <div class="col-12 text-center" style="font-size:0.8rem;">Query</div>
                        </a>
                        <hr class="left-menu-item-line">
                        <a class="nav-link row" id="complaints-nav-link" href="#" onclick="displayComplaints()">
                            <div class="col-12 text-center">
                                <i class="fas fa-map-marker-alt fa-2x"></i>
                            </div>
                            <div class="col-12 text-center" style="font-size:0.8rem;">Complaints</div>
                        </a>
                        <hr class="left-menu-item-line">
                    </nav>
                </div>
                <div class="col">
                        <div class="panel-body-parts d-none" id="layers">
                            <h6 class="layer-title">Base Layers</h6>
                            <div class="form-check form-switch text-secondary">
                                <input class="form-check-input" type="radio" name = "basemap" id="basemap0" value='OSM' unchecked>
                                <label class="form-check-label" for="basemap0">OpenStreetMap</label>
                            </div>
                            <div class="form-check form-switch text-secondary">
                                <input class="form-check-input" type="radio" name ="basemap" id="basemap1" value='BingMaps' unchecked>
                                <label class="form-check-label" for="basemap1">Bing Satellite</label>
                            </div>
                            <div class="form-check form-switch text-secondary">
                                <input class="form-check-input" type="radio" name ="basemap" id="basemap2" value='CartoLight' checked>
                                <label class="form-check-label" for="basemap2">CartoDB Light</label>
                            </div>
                            <div class="form-check form-switch text-secondary">
                                <input class="form-check-input" type="radio" name ="basemap" id="basemap3" value='CartoDark' unchecked>
                                <label class="form-check-label" for="basemap3">CartoDB Dark</label>
                            </div>
                            <hr style="color: #FFF;">
                            <h6 class="layer-title">Utility Layers</h6>
                            <fieldset id="layer0">
                                <div class="form-check form-switch text-secondary">
                                    <input class="form-check-input" type="checkbox" id="visible0" checked>
                                    <label class="form-check-label" for="visible0">Boundary</label>
                                </div>
                            </fieldset>
                            <fieldset id="layer1">
                                <div class="form-check form-switch text-secondary">
                                    <input class="form-check-input" type="checkbox" id="visible1" checked>
                                    <label class="form-check-label" for="visible1">Buildings</label>
                                </div>
                            </fieldset>
                        </div>
                        <div class="panel-body-parts d-none" id="query-feature">
                            <div class="form-group">
                                <label class="layer-title" for="title">Feature Of</label>
                                <select class="form-control" id="featureOf" style="width: 150px;">
                                    <option>Complaints</option>
                                    <option>Buildings</option>
                                    <option>Septic Water Tank</option>
                                    <option>Open Space</option>
                                    <option>Road</option>
                                    <option>Transmission Line</option>
                                    <option>Water Pipeline</option>
                                    <option>Drainage Line</option>
                                    <option>Water Point</option>
                                    <option>Electric Pole</option>
                                    <option>Drainage Point</option>
                                    <option>Temple</option>
                                </select>
                            </div>
                            <button class="btn btn-warning" style="width:45%" id="query" onclick="clickQuery()">Query</button>
                        </div>
                        <div class="panel-body-parts d-none" id="complaints">
                            <div class="form-group text-light">
                                <label for="title">Problem:</label>
                                <input type="text" class="form-control" id="problem" />
                            </div>
                            <div class="form-group text-light">
                                <label for="title">Description:</label>
                                <input type="text" class="form-control" id="description"
                                    placeholder="Detailed Information" />
                            </div>
                            <div class="form-group text-light">
                                <label for="title">Service:</label>
                                <input type="text" class="form-control" id="servicetype" placeholder="Emergency/Normal" />
                            </div>
                            <div class="form-group text-light">
                                <label for="title">Email:</label>
                                <input type="text" class="form-control" id="email" placeholder="name@gmail.com" />
                            </div>
                            <button class="btn btn-warning " style="width:45%" onclick="drawComplaints()">Add</button>
                            <button class="btn btn-primary d-none" style="width:45%"
                                onclick="deleteBuilding()">Delete</button>
                        </div>
                </div>
            </div>
        </div>
    </div>

    <!-- <div id="popup" class="ol-popup">
        <div id="popup-content"></div>
    </div> -->

    <div class="form-group" id="inputPannel" style="position: absolute; top: 80px; right: 100px; display: none;">
        <input type="keyWords" class="form-control" id="keyWordsInput" placeholder="Input Service Type">
    </div>
    <div id="keyWordsOptions" class="keyWordsOptions">
        <select multiple class="form-control" id="keyWordsTable"></select>
    </div>

    <!-- Modal for user help-->
    <div class="modal fade" id="helpmodal" tabindex="-1" aria-labelledby="helpmodalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="helpmodalLabel">
                        <h4>Web-based Utility Management System for Kathmandu University</h4>
                    </h5>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-body">
                    1. <i class="fas fa-pen"></i>
                    Measure distance by drawing line.<br>2. <i class="far fa-clone"></i> Measure Area by drawing polygon.<br>3. <i class="fas fa-eraser"></i> Reset Everything to defaults.<br>4.
                    <i class="fas fa-home"></i> Default Extent of the map. <br>5.
                    <i class="fas fa-search"></i> Query Complaints by passing
                    Service Type Parameters.<br>6. Under
                    Layers, select one or
                    more layers to turn on/off visibility.<br>7. Under Query Feature, select a layer and select query
                    to query the layer's features. You can edit the attribute and geometry of the features as well
                    by clicking edit and submit buttons.<br>9. Under complaints, you can add or delete complaints
                    regarding utilities on the housing area.<br>10. Admin can edit the attribute Charge of Complaints
                    feature and send email
                    based on that to the clients as a serive bill.<br><br> <b>-Developed by Raj Bhattarai and team.</b>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="{% static 'utilities/js/utils.js' %}"></script>
    <!-- <script type="text/javascript" src="{% static 'utilities/js/functionalities.js' %}"></script> -->
    <script type="text/javascript" src="{% static 'utilities/js/panel.js' %}"></script>
    <script type="text/javascript" src="{% static 'utilities/js/styles.js' %}"></script>
    <script type="text/javascript" src="{% static 'utilities/js/map.js' %}"></script>
    <script type="text/javascript" src="{% static 'utilities/js/measurement.js' %}"></script>
    <!-- <script type="text/javascript" src="{% static 'utilities/js/edit.js' %}"></script> -->

{% endblock %}
{% block links %}
{% endblock %}
